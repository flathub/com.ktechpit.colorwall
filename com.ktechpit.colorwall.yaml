app-id: com.ktechpit.colorwall
runtime: org.kde.Platform
runtime-version: 5.15-25.08
sdk: org.kde.Sdk
command: colorwall
finish-args:
  - --share=network
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --filesystem=xdg-download
  - --filesystem=xdg-pictures
  - --device=dri
  - --env=INSTALL_TYPE=flatpak
  - --talk-name=org.freedesktop.FileManager1
  - --filesystem=xdg-run/gvfsd

cleanup:
  - /include
  - /lib/pkgconfig

modules:

  - shared-modules/squashfs-tools/squashfs-tools.json

  - name: libgumbo
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/google/gumbo-parser/archive/v0.10.1.tar.gz
        sha256: 28463053d44a5dfbc4b77bcf49c8cee119338ffa636cc17fc3378421d714efad
    cleanup:
      - /lib/pkgconfig
      - /include
      - '*.a'
      - '*.la'

  - name: colorwall
    buildsystem: simple
    build-commands:
      - unsquashfs -no-progress tPiGTcpRYwWhmLFqKMefGzuC6isfwbci*.snap
      - install -Dm755 squashfs-root/usr/bin/colorwall ${FLATPAK_DEST}/bin/colorwall
      - mkdir -p ${FLATPAK_DEST}/share/icons/hicolor/
      - cp -r squashfs-root/usr/share/icons/hicolor/* ${FLATPAK_DEST}/share/icons/hicolor/
      - install -Dm644 squashfs-root/usr/share/applications/com.ktechpit.colorwall.desktop ${FLATPAK_DEST}/share/applications/com.ktechpit.colorwall.desktop
      - desktop-file-edit --set-icon=${FLATPAK_ID} ${FLATPAK_DEST}/share/applications/com.ktechpit.colorwall.desktop
      - install -Dm644 squashfs-root/usr/share/metainfo/com.ktechpit.colorwall.metainfo.xml ${FLATPAK_DEST}/share/metainfo/com.ktechpit.colorwall.metainfo.xml
    sources:
      - type: file
        # curl -H 'Snap-Device-Series: 16' https://api.snapcraft.io/v2/snaps/info/colorwall | jq '."channel-map"' | jq '.[]' | jq '[."download"."url"]' | grep -m1 https | tr -d ' ' | tr -d '"'
        # also update build-command whenever update url
        url: https://api.snapcraft.io/api/v1/snaps/download/tPiGTcpRYwWhmLFqKMefGzuC6isfwbci_29.snap
        only-arches:
          - x86_64
        # curl -Ls https://api.snapcraft.io/api/v1/snaps/download/tPiGTcpRYwWhmLFqKMefGzuC6isfwbci_29.snap | sha256sum
        sha256: 0cccb2b3df3f97866e6a282568c487dc6d8ed34f3525a726634b0446948b514a
#END 2024-05-10
